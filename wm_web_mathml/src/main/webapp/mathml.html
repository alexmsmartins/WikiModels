<lift:surround with="default" at="content">

    <div id="some-div">
        <h2>Welcome to WikiModels MathML Editor.</h2>

        <div>
            <lift:MathMLEdit form="POST">
                <head>
                <script id="xslttransform" type="text/javascript">
                /* <![CDATA[ */
                  function loadXMLDoc(dname)
                    {
                    $.log("loadXMLDoc(dname) is executing")
                    if (window.XMLHttpRequest)
                      {
                      xhttp=new XMLHttpRequest();
                      }
                    else
                      {
                      xhttp=new ActiveXObject("Microsoft.XMLHTTP");
                      }
                    xhttp.open("GET",dname,false);
                    xhttp.send("");
                    return xhttp.responseXML;
                    }
               function displayResult()
                  {
                  $.log("displayResult is executing");

                  var xml = null;
                  // code for IE
                  if (window.ActiveXObject)
                    {
                    xml = $("#formula").xml;
                    }
                  else if (document.implementation && document.implementation.createDocument)
                    {
                    var node = $("#formula");
                    xml = node.children()[0];
                    }
                  
                  var xsl=loadXMLDoc("/xslt/mathmlc2p.xsl");
                  
                  // code for IE
                  if (window.ActiveXObject)
                    {
                    ex=xml.transformNode(xsl);
                    document.getElementById("formula").innerHTML=ex;
                    }
                  // code for Mozilla, Firefox, Opera, etc.
                  else if (document.implementation && document.implementation.createDocument)
                    {
                    var xsltProcessor=new XSLTProcessor();
                    xsltProcessor.importStylesheet(xsl);
                    var resultDocument = xsltProcessor.transformToFragment(xml,document);
                    var div = document.getElementById("formula");
                    div.replaceChild(resultDocument, div.firstChild );
                    }
                  }                  
                /* ]]> */
            </script>
                </head>
            <script id="mathjax" src="/MathJax/MathJax.js" type="text/javascript">
            /* <![CDATA[ */
            $(document).ready(function() {
                displayResult();
                $.log("MathJax is executing");
                MathJax.Hub.Config({
                    config: ["MMLorHTML.js"],
                    extensions: ["tex2jax.js", "mml2jax.js"],
                    jax: ["input/TeX", "input/MathML"]
                });
            });
            /* ]]> */
            </script>
                <lift:ignore>
                    <!-- TODO LEARN error messages from the framework -->
                </lift:ignore>
                <lift:msgs id="parsing_error"/>

                <link rel="stylesheet" type="text/css" href="css/mathml_editor.css"/>
                <a href="http://www1.chapman.edu/~jipsen/asciimath.html">To get help in ASCIIMathML syntax click here.</a>

                <error:box>
                  <span id="box_error_message"></span>
                </error:box>

                   <div>
                    <visualizer:formulaViz>
                        <span id="form_viz"></span>
                    </visualizer:formulaViz>
                    <editor:formula/>
                </div>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <editor:submit />
            </lift:MathMLEdit>
        </div>
    </div>
    <!-- end of "some-div"-->
</lift:surround>
