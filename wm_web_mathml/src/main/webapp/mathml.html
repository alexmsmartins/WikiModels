<lift:surround with="default" at="content">

    <div id="some-div">
        <h2>MahtML Editor is below this.</h2>

        <div>
            <lift:MathMLEdit form="POST">
                <head>
                <script id="xslttransform" type="text/javascript">
                /* <![CDATA[ */
                  function loadXMLDoc(dname)
                    {
                    $.log("loadXMLDoc(dname) is executing")
                    if (window.XMLHttpRequest)
                      {
                      xhttp=new XMLHttpRequest();
                      }
                    else
                      {
                      xhttp=new ActiveXObject("Microsoft.XMLHTTP");
                      }
                    xhttp.open("GET",dname,false);
                    xhttp.send("");
                    return xhttp.responseXML;
                    }

               function displayResult()
                  {
                  alert("displayResult is executing");
                  $.log("displayResult is executing");

                  var xml = null;
                  // code for IE
                  if (window.ActiveXObject)
                    {
                    xml = $("#formula").xml;
                    }
                  else if (document.implementation && document.implementation.createDocument)
                    {
                    var node = $("#formula");
                    alert("node = "+node);
                    alert("node.html() = "+node.html());
                    //xml = (new XMLSerializer()).serializeToString( node.children()[0] ); // [0] avoids "Security error"
                    xml = node.children()[0];
                    alert("xml = " + xml);
                    }

                  alert("Type of xml is " + typeof xml);
                  alert(xml);
                  var xsl2=loadXMLDoc("mathml_content.xml");
                  alert("Type of xml loaded from a file is " + typeof xml2);
                  alert(xsl2);
                  
                  var xsl=loadXMLDoc("/xslt/mathmlc2p.xsl");
                  
                  // code for IE
                  if (window.ActiveXObject)
                    {
                    ex=xml.transformNode(xsl);
                    document.getElementById("formula").innerHTML=ex;
                    }
                  // code for Mozilla, Firefox, Opera, etc.
                  else if (document.implementation && document.implementation.createDocument)
                    {
                    xsltProcessor=new XSLTProcessor();
                    xsltProcessor.importStylesheet(xsl);
                    resultDocument = xsltProcessor.transformToFragment(xml,document);
                    document.getElementById("formula").appendChild(resultDocument);
                    }
                  }
                  
                function displayResult2()
                  {
                  alert("displayResult2 is executing");
                  $.log("displayResult2 is executing");
                  var xml=loadXMLDoc("mathml_content.xml");
                  if(xml == null)
                    {
                      $.log("xml is null");
                    } else {
                      $.log("xml not null");
                    }

                  var xsl=loadXMLDoc("/xslt/mathmlc2p.xsl");
                  if(xsl == null)
                    {
                    $.log("xslt is null");
                    } else {
                    $.log("xslt not null")
                    }

                  // code for IE
                  if (window.ActiveXObject)
                    {
                    ex=xml.transformNode(xsl);
                    document.getElementById("formula").innerHTML=ex;
                    }
                  // code for Mozilla, Firefox, Opera, etc.
                  else if (document.implementation && document.implementation.createDocument)
                    {
                    xsltProcessor=new XSLTProcessor();
                    xsltProcessor.importStylesheet(xsl);
                    resultDocument = xsltProcessor.transformToFragment(xml,document);
                    document.getElementById("formula").appendChild(resultDocument);
                    }
                  }
                /* ]]> */
            </script>
                </head>
            <script id="mathjax" src="/MathJax/MathJax.js" type="text/javascript">
            /* <![CDATA[ */
            $(document).ready(function() {
                displayResult();
                alert("MathJax is executing");
                $.log("MathJax is executing");
                MathJax.Hub.Config({
                    config: ["MMLorHTML.js"],
                    extensions: ["tex2jax.js", "mml2jax.js"],
                    jax: ["input/TeX", "input/MathML"]
                });
            });
            /* ]]> */
            </script>
                <lift:ignore>
                    <!-- TODO LEARN error messages from the framework -->
                </lift:ignore>
                <lift:msgs id="parsing_error"/>

                <link rel="stylesheet" type="text/css" href="css/mathml_editor.css"/>
                <a href="http://www1.chapman.edu/~jipsen/asciimath.html">Help with AsciiMathML</a>

                <p id="parse_success" class="success">Parsing succeded</p>
                <p id="parse_failed" class="error"> Error parsing AsciiMathML</p>
                <div>
                    <visualizer:formulaViz>
                        <span id="form_viz"></span>
                    </visualizer:formulaViz>
                    <editor:formula/>
                </div>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <br/>
                <editor:submit />
            </lift:MathMLEdit>
        </div>
    </div>
    <!-- end of "some-div"-->
</lift:surround>
